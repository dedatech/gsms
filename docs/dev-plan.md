# GSMS 项目研发计划（dev-plan）

## 1. 概述
本研发计划文档用于指导 GSMS（工时管理系统）后端的整体设计与迭代实施。系统目标为：
- **便捷录入**：降低一线员工登记工时的操作成本，提高录入意愿与及时性；
- **多维统计**：为项目经理、业务经理、管理层提供多维度的工时与任务数据分析；
- **数据安全与可追溯**：通过统一的权限模型与逻辑删除策略，保障历史数据可追踪、可审计。

## 2. 总体架构与关键技术

- **技术栈**：
  - 后端语言：Java 8+
  - 框架：Spring Boot
  - 持久层：MyBatis / MyBatis-Plus
  - 鉴权：基于 JWT 的 Token 身份认证
  - 文档：OpenAPI 3 + Springdoc
  - 数据库：MySQL

- **基础设施能力**：
  - 统一返回结构：`Result<T>` 封装业务返回码、提示信息与数据；
  - 统一错误码：通过错误码接口和通用错误码枚举，规范错误表达；
  - 全局异常处理：`GlobalExceptionHandler` 兜底处理业务异常、参数校验异常及系统异常；
  - 身份认证：`JwtUtil` + `JwtInterceptor` + `WebConfig` 实现登录后基于 Token 的接口访问控制。

## 3. 角色与权限体系设计

### 3.1 RBAC 模型

系统采用基于 RBAC（Role-Based Access Control）的统一角色权限模型，不在业务代码中写死具体角色逻辑。核心概念包括：

- **角色（Role）**：表达一类用户在系统中的职责与权限集合，例如：系统管理员、业务经理、项目经理、员工等；
- **权限点（Permission）**：表达一项具体业务能力或资源操作，例如：查看所有项目、管理成员项目任务、审批成员项目工时等；
- **角色-权限关联（RolePermission）**：角色与权限点之间的多对多绑定，通过配置定义“某类角色可以做什么”；
- **用户-角色关联（UserRole）**：用户与角色之间的多对多绑定，允许一个用户拥有一个或多个角色；

通过上述模型，可以在不修改业务代码的前提下，通过配置增加或调整角色与权限点。

### 3.2 预置角色与职责

系统将预置 4 类典型角色，作为默认配置，可通过 RBAC 模型调整其权限：

- **系统管理员（SYS_ADMIN）**：
  - 拥有全局读写权限；
  - 可以管理所有项目、任务、工时、用户、部门以及角色与权限配置。

- **业务经理（BUSINESS_MANAGER）**：
  - 拥有全局只读权限；
  - 可以查看所有项目及相关统计报表，但不能对项目、任务、工时等核心数据进行修改。

- **项目经理（PROJECT_MANAGER）**：
  - 数据范围限于其参与（为项目成员）的项目；
  - 可以在这些项目范围内管理任务、审批成员工时、维护项目成员列表等。

- **员工（EMPLOYEE）**：
  - 数据范围限于其被加入为项目成员的项目；
  - 可以查看相关项目及任务，并登记、维护自己的工时记录（受流程约束）。

上述角色对应的权限集通过权限点配置实现，业务代码只依赖“是否具备某权限点”，不依赖角色名称本身。

## 4. 数据范围与项目成员

### 4.1 项目成员模型

为实现项目级数据范围控制，引入项目成员模型：

- 每个项目维护一份成员列表（ProjectMember），记录 `projectId` 与 `userId` 的关联关系；
- 项目经理创建项目时，系统默认将其自身加入该项目成员列表；
- 任务的负责人必须是该项目成员之一；
- 工时记录中选择的项目与任务，必须在当前用户作为成员参与的项目范围内。

### 4.2 数据可见范围规则

在 RBAC 权限控制的基础上，数据范围按如下规则约束：

- 系统管理员、业务经理：
  - 可查看全系统范围内的项目、任务、工时及统计数据；
  - 业务经理仅限只读，不具备写操作权限。

- 项目经理：
  - 仅可访问自己成员项目下的项目、任务、工时与统计数据；
  - 可对成员项目进行管理（如维护任务、审批工时、维护项目成员）。

- 员工：
  - 仅可访问自己成员项目范围内的数据；
  - 只能维护自己的工时记录，任务管理能力可根据权限点细化配置（如是否允许创建任务、修改任务状态等）。

## 5. 全局逻辑删除策略

系统统一采用逻辑删除策略，以保障历史数据可追溯、统计口径一致并支持审计：

- 所有核心业务实体（如项目、迭代、任务、工时、用户、部门等）的删除操作均通过统一的逻辑删除标记实现软删除，禁止直接物理删除；
- 默认业务查询接口（列表、详情）应自动排除已逻辑删除的数据；
- 统计分析与审计场景可根据需要决定是否包含已逻辑删除的数据；
- 持久层建议统一采用 MyBatis-Plus 等框架提供的逻辑删除能力，减少手工实现差异。

## 6. 模块划分与职责

- **项目与迭代管理模块**：
  - 负责项目与迭代生命周期管理（创建、编辑、归档等）；
  - 管理项目成员列表，与权限体系结合控制数据范围；
  - 提供项目概览数据的聚合接口。

- **任务管理模块**：
  - 负责任务、需求、缺陷等工作项的管理；
  - 提供任务列表、看板视图、批量操作能力；
  - 约束任务负责人必须为项目成员。

- **我的工时模块**：
  - 聚焦个人工时登记与管理；
  - 提供按日历视图填报工时的能力；
  - 支持工时状态流转（已保存/已提交/已确认）与审批流程。

- **数据统计模块**：
  - 提供项目、部门、个人、任务等多维度的统计与图表；
  - 支持计划工时与实际工时对比、饱和度与效能分析；
  - 在权限与数据范围约束下输出统计结果。

- **系统设置模块**：
  - 负责用户、部门、角色、权限、数据字典与操作日志等系统级配置；
  - 提供 RBAC 模型的角色与权限管理界面和接口。

## 7. 迭代计划与里程碑

### 7.1 迭代一：基础框架与安全基线

- 搭建 Spring Boot + MyBatis 基础框架与工程结构；
- 实现统一返回结构、错误码与全局异常处理；
- 引入 JWT 登录与基础鉴权逻辑；
- 建立初始数据库表结构（包含核心实体与逻辑删除字段）。

### 7.2 迭代二：RBAC 与项目成员

- 实现通用 RBAC 模型（角色、权限点、角色-权限、用户-角色）；
- 引入项目成员模型，并在项目创建时自动加入项目经理；
- 在项目、任务、工时等核心接口中引入数据范围控制（基于角色 + 项目成员）。

### 7.3 迭代三：我的工时与审批流

- 完成“我的工时”门户接口（当前用户视角的工时列表与日历数据）；
- 支持工时的状态流转与审批（员工提交，项目经理/系统管理员确认）；
- 确保工时操作受角色与项目成员双重约束。

### 7.4 迭代四：统计分析与项目概览

- 完善项目/部门/个人/任务/趋势等统计接口；
- 提供项目概览仪表盘接口，聚合项目健康度核心指标；
- 视需要增加报表导出能力（Excel/PDF 等）。

### 7.5 迭代五：系统设置与审计

- 完善角色与权限管理界面与接口；
- 增加数据字典管理能力；
- 实现操作日志记录与查询能力，覆盖登录、删除、权限变更、审批等关键动作。

## 8. 风险与注意事项

- 逻辑删除会增加部分查询复杂度与统计实现难度，需要在设计之初统一规范并做好索引；
- 权限与数据范围逻辑应尽量集中在统一的鉴权与数据访问层，避免在业务代码中到处散落 if 判断；
- 随着角色与权限配置日益复杂，需要配合审计日志与必要的配置回滚机制，避免误配置影响生产环境行为。
